version: "3.4"

services:
  #suppliers-portal-api:
  #  build:
  #    context: ./suppliers/src/API
  #    args:
  #      - "GITHUB_NUGET_USERNAME=${GITHUB_NUGET_USERNAME}"
  #      - "GITHUB_NUGET_PAT=${GITHUB_NUGET_PAT}"
  #  image: embcess-suppliers-api:dev
  #  ports:
  #    - 7020:8080
  #  env_file:
  #    - .env

  #suppliers-portal-ui:
  #  build:
  #    context: ./suppliers/src/UI
  #  image: embcess-suppliers-ui:dev
  #  ports:
  #    - 7200:2015
  #  environment:
  #    - "API_URL=suppliers-portal-api:8080"
  #  depends_on:
  #    - suppliers-portal-api

  registrants-portal-api:
    build:
      dockerfile: ./build/Registrants/Registrants.API.Dockerfile
      context: ./src
    image: embcess-registrants-api:dev
    ports:
      - 5020:8080
    env_file:
      - .env

  registrants-portal-ui:
    build:
      dockerfile: ./build/Registrants/Registrants.UI.Dockerfile
      context: ./src
    image: embcess-registrants-ui:dev
    ports:
      - 5200:2015
    environment:
      - "API_URL=registrants-portal-api:8080"
    depends_on:
      - registrants-portal-api

  responders-portal-api:
    build:
      dockerfile: ./build/Responders/Responders.API.Dockerfile
      context: ./src
    image: embcess-responders-api:dev
    ports:
      - 6020:8080
    environment:
      - "BACKEND__URL=https://ess-backend:8080"
      - "BACKEND__ALLOWINVALIDSERVERCERTIFICATE=true"
    env_file:
      - .env
    depends_on:
      - ess-backend

  responders-portal-ui:
    build:
      dockerfile: ./build/Responders/Responders.UI.Dockerfile
      context: ./src
    image: embcess-responders-ui:dev
    ports:
      - 6200:2015
    environment:
      - "API_URL=responders-portal-api:8080"
    depends_on:
      - responders-portal-api

  ess-backend:
    build:
      dockerfile: ./build/ESS/ESS.Dockerfile
      context: ./src
    image: embcess-backend-api:dev
    ports:
      - 2020:8080
    env_file:
      - .env
    environment:
      - "ASPNETCORE_Kestrel__Certificates__Default__Path=/ssl/aspnetapp.pfx"
    volumes:
      - ~/.aspnet/https:/ssl/
      
  pdf-generator:
    build:
      dockerfile: ./build/PdfGenerator/PdfGenerator.Dockerfile
      context: ./src
    image: embcess-pdf-generator:dev
    ports:
      - 8200:8080
    env_file:
      - .env
    environment:
      - "ASPNETCORE_Kestrel__Certificates__Default__Path=/ssl/aspnetapp.pfx"
    volumes:
      - ~/.aspnet/https:/ssl/
      
  landing-page:
    build:
      context: ./landing-page/src
    image: landing-page:dev
    ports:
      - 7200:2015